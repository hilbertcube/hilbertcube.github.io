---
/**
 * HighlightsAndAttribute.astro
 * ============================
 * Sidebar highlights and attribution.
 * Highlights are resolved at build time from articles.json â€” no runtime fetch.
 */
import fs from "node:fs";
import path from "node:path";

const jsonPath = path.resolve("assets/json/articles.json");
const { articles } = JSON.parse(fs.readFileSync(jsonPath, "utf-8"));

const highlightIds = ["orb-cuda-1", "chladni-1", "chladni-2", "hessian-1"];
const highlights = highlightIds
  .map((id) => articles.find((a: { id: string }) => a.id === id))
  .filter(Boolean);
---

<div class="side-nav-content-container">
  <section style="border-top: 1px solid #b4b4b4;">
    <header class="major">
      <h2 style="margin: 0.75em 0;">Website's Data</h2>
    </header>
    <div class="commit-log-container">
      <div class="commit-log-content">
        <span class="commit-log-header">// Fetched via Github API</span>
        <span id="repo-stats">Loading...</span>
        <span id="commit-info">Loading...</span>
      </div>
    </div>
    <style is:global>
      .commit-log-container {
        max-width: 300px;
        margin: 20px auto;
        border-radius: 6px;
        padding: 5px 16px;
      }
      .light-mode .commit-log-container {
        background: #f5f5f5;
        border: 1px solid #d0d0d0;
      }
      .dark-mode .commit-log-container {
        background: #1e1e1e;
        border: 1px solid #3e3e3e;
      }
      .commit-log-content {
        font-family: "Courier New", Consolas, monospace;
        font-size: 11px;
        line-height: 1.6;
        white-space: pre-line;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .light-mode .commit-log-content {
        color: #2e2e2e;
      }
      .dark-mode .commit-log-content {
        color: #d4d4d4;
      }
      .light-mode .commit-log-header {
        color: #22863a;
      }
      .dark-mode .commit-log-header {
        color: #6a9955;
      }
    </style>
  </section>

  <section>
    <header class="major">
      <h2 style="margin: 0.75em 0;">Highlights</h2>
    </header>
    <div class="highlights">
      <ul id="suggestion-container">
        {
          highlights.map(
            (article: {
              id: string;
              title: string;
              image: string;
              link: string;
            }) => (
              <li class="home-li" data-id={article.id}>
                <span>{article.title}</span>
                <a href={article.link} target="_blank" class="recommend-img">
                  <img
                    src={`/public/Images/${article.image}`}
                    alt={article.title}
                    loading="lazy"
                    style="max-height: 0; opacity: 0;"
                  />
                </a>
              </li>
            ),
          )
        }
      </ul>
    </div>
  </section>

  <section>
    <div class="attribute">
      <div
        style="font-weight: bold; font-size: 1em; text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 4px;"
      >
        About this Website
      </div>
      <div>Logo generated by a double pendulum simulation</div>
      <div>Website designed by me</div>
      <div>
        Design inspired by <a
          href="https://html5up.net/editorial"
          class="hyperlink"
          target="_blank">Editorial</a
        > by HTML5 UP
      </div>
      <div>Idea from 2023, created in 2024</div>
    </div>
  </section>
</div>
